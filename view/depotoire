<?php if(!empty($message)) : ?>
<p><?php echo $message; ?></p>
<?php endif; ?>

<form action="../controller/ajoutlieu_controller.php" method="post">
<div class="container">
  <div class="row">
        <div class="col-md-6" >
        <h3 >Ajouter un nouveau lieu</h3>

            <div class="input-group" style="margin-top: 150px; ">
              <span class="input-group-addon custom__addon" style="background-color: DodgerBlue;">
                <span class="glyphicon glyphicon-cog"></span>  Pseudo
              </span>
              <input type="text" maxlength="15" placeholder="Entrez votre nom/pseudo..." name="pseudo" id="pseudo" value=""<?php if(!empty($_POST['pseudo'])) { echo htmlspecialchars($_POST['pseudo'], ENT_QUOTES); } ?>"">
            </div>
            <hr />

            <div class="input-group">
              <span class="input-group-addon custom__addon" style="background-color: Gold;">
                <span class="glyphicon glyphicon-cog"></span>  Nom lieu
              </span>
              <input type="text" maxlength="40" placeholder="Entrez la ville..." maxlength="40" name="nomlieu" id="nomlieu" value=""<?php if(!empty($_POST['nomlieu'])) { echo htmlspecialchars($_POST['nomlieu'], ENT_QUOTES); } ?>"">
            </div>
            <hr />

            <div class="input-group">
              <span class="input-group-addon custom__addon" style="background-color: LimeGreen;">
                <span class="glyphicon glyphicon-cog"></span>  Description
              </span>

                <textarea  maxlength="500" name="description" cols="40" rows="5" placeholder="Entrez la description du lieu ici..."></textarea>

            </div>
            <hr/>

            <div class="input-group">
              <span class="input-group-addon custom__addon" style="background-color: Gold;">
                <span class="glyphicon glyphicon-cog"></span>  Ville
              </span>
              <input type="text" placeholder="Entrez la ville ici..." maxlength="40" name="ville" id="ville" value=""<?php if(!empty($_POST['ville'])) { echo htmlspecialchars($_POST['ville'], ENT_QUOTES); } ?>"">
            </div>
            <hr />


            <div class="input-group">
              <span class="input-group-addon custom__addon" style="background-color: Gold;">
                <span class="glyphicon glyphicon-cog"></span>  Code Postal
              </span>
              <input type="text" placeholder="Entrez le code postal ici..." maxlength="40" name="cpville" id="cpville" value=""<?php if(!empty($_POST['cpville'])) { echo htmlspecialchars($_POST['cpville'], ENT_QUOTES); } ?>"">
            </div>
            <hr />

            <div class="input-group">
              <span class="input-group-addon custom__addon" style="background-color: Gold;">
                <span class="glyphicon glyphicon-cog"></span>  Adresse Lieu
              </span>
              <input type="text" placeholder="Entrez la ville..." maxlength="40" name="adrlieu" id="adrlieu" value=""<?php if(!empty($_POST['adrlieu'])) { echo htmlspecialchars($_POST['adrlieu'], ENT_QUOTES); } ?>"">
            </div>
            <hr />

            <div class="input-group">
              <span class="input-group-addon custom__addon" style="background-color: MediumPurple;">
                <span class="glyphicon glyphicon-cog"></span>  URL Image
              </span>
              <input type="url" placeholder="Entrez l'url de l'image ici..." name="urlim" id="urlim" value=""<?php if(!empty($_POST['urlim'])) { echo htmlspecialchars($_POST['urlim'], ENT_QUOTES); } ?>"">
            </div>
            <hr />

            <div class="input-group">
              <span class="input-group-addon custom__addon" style="background-color: Crimson;">
                <span class="glyphicon glyphicon-cog"></span>  Catégorie
              </span>
              <select class="form-control custom__select">
                <option value="aucune">Aucune</option>
                <?php
                foreach ($categories as $categorie){
                  echo '<option value="'.$categorie['idcat'].'">'.$categorie['nomcat'].'</option>'; //Affiche chaque nom (ex: Informatique et Gestion) de chaque département de la base de données
                }
                ?>
            </select>
          </div>

            <hr />

            <div class="input-group">
              <span class="input-group-addon custom__addon" style="background-color: LimeGreen;">
                <span class="glyphicon glyphicon-cog"></span> Mots Clés
              </span>

                <textarea name="motscles" cols="40" rows="5" placeholder="Entrez les mots clés ici, séparé par un ';'..."></textarea>

            </div>
            <hr/>




            <input type="submit" value="Submit">
        </div>
  </div>
</div>


</form>



  $pseudo=$_POST['pseudo'];
  $nomlieu=$_POST['nomlieu'];
  $description=$_POST['description'];
  $ville=$_POST['ville'];
  $cpville=$_POST['cpville'];
  $url=$_POST['urlim'];
  $categorie=$_POST['categorie'];
  $adr=$_POST['adrlieu'];
  $motscles=$_POST['motscles'];
  $motcle = explode(";", $motscles);
  $bool = true;



// Si le tableau $_POST existe alors le formulaire a été envoyé
if(!empty($_POST))
  {
// Le login est-il rempli ?
if(empty($pseudo))
{
  $message = 'Veuillez indiquer votre pseudo !';
}
  // Le mot de passe est-il rempli ?
  elseif(empty($nomlieu))
{
  $message = 'Veuillez indiquer le nom du lieu';
}
  // Le mot de passe est-il correct ?
  elseif(empty($ville)
{
  $message = 'Veuillez indiquer la ville où se trouve le lieu';
}
  else
{

  if(!is_null(existeLieu($nomlieu, $ville))){


    if(is_null(existeVille($cpville))){
      $dep=substr($cpville, 0, 1);
      if(is_null(existeDepartement($dep))){
        $message = 'Le code postal n''est pas valide';
        $bool = false;
      }else {
        $iddep=getIdNDepartement($dep);
        creerVille($ville,$cpville,$iddep);
      }
    }

    if($bool){
          if(is_null(existePseudo($pseudo))){
            creerPseudo($pseudo);
          }
          $idpseudo=getIdPseudo($pseudo);
          $idville=getIdVille($ville);
          $idcat=getIdCategorie($categorie);
          creerLieu($nomlieu, $url, $description, $adr, $idpseudo, $idville, $idcat);
          $idlieu=getIdLieu($nom);
          for($i=0; $i<count($motcle); $i++){
            if(is_null($motcle[$i])){
              creerMotCle($motcle[$i]);
              $idmotcle=getIdMotCle($motcle[$i]);
              creerMotCleLieu($idlieu, $idmotcle);
            }
          }
          // L'identification a réussi
        $message = 'Votre lieu a bien été ajouté !';
    }



}else{
  $message='Le lieu dans cette ville existe déjà';
}



}
}
